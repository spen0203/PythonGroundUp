#saves to a local file server.py

import flask, jinja2, io, base64
import stereo

app = flask.Flask(__name__) #create flask server object named after file being ran

#jinja2 template, {{___}} is a variable place holder
template = jinja2.Template("""
<html>
    <body>
    <img src="data:image/png;base64, {{imgdata}}"/>      
    </body>
</html>

""")

#Takrd an image and incodes it into base64 ascii text so it can be passed as a response
def makeimgdata(img):
    buffer = io.BytesIO()
    img.save(buffer,format="PNG")
    return nase64.b64encode(buffer.getvalue()).decode('ascii')

#URL to reply to (http://localhost:5000/1036)
@app.route('/<sol>') #Route <sol> argument is linked to the function sol
def getsol(sol):
    left,right = stereo.getday(sol).__next__() #get the left image than iterate to right image
    
    img = stereo.blend(stereo.getimage(left),stereo.getimage(right)) #blend two images into one
    
    html = template.render(imgdata=makeimgdata(img)) #Render the template and input var for imgdata(needs to be converted to text)
    
    return flask.Response(html)


#URL to reply to (http://localhost:5000/ )
@app.route('/') 
def hello_world(sol):
    return flask.Response('<html><body><p>Hello there, world!</p></body></html>')

app.run(host='localhost')
